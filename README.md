# TMA Boilerplate

**Production-ready Telegram Mini App Boilerplate**

A modern, type-safe monorepo starter template for building Telegram Mini Apps with Next.js 16 and Express.

---

## âœ¨ Features

- **ğŸš€ Next.js 16** â€” Latest App Router with Turbopack
- **âš¡ Express API** â€” TypeScript backend with middleware
- **ğŸ“¦ pnpm Workspaces** â€” Efficient monorepo management
- **ğŸ¨ Tailwind CSS + shadcn/ui** â€” Beautiful, accessible components
- **ğŸ”’ Type Safety** â€” Shared types between frontend and backend
- **ğŸ”§ Mock Environment** â€” Develop in browser without deploying to Telegram
- **ğŸ“± Telegram WebApp API** â€” Full TypeScript definitions included

---

## ğŸ“ Project Structure

```
tma-boilerplate/
â”œâ”€â”€ apps/
â”‚   â”œâ”€â”€ web/          # Next.js 16 frontend
â”‚   â””â”€â”€ api/          # Express backend
â”œâ”€â”€ packages/
â”‚   â””â”€â”€ shared/       # Shared types & utilities
â””â”€â”€ package.json      # Root workspace config
```

---

## ğŸš€ Quick Start

### Prerequisites

- Node.js 18+
- pnpm 8+

### Installation

```bash
# Clone the repository
git clone https://github.com/your-repo/tma-boilerplate.git
cd tma-boilerplate

# Install dependencies
pnpm install

# Copy environment files
cp apps/api/.env.example apps/api/.env
```

### Development

```bash
# Start both frontend and backend
pnpm dev

# Or start individually
pnpm dev:web   # Next.js on http://localhost:3000
pnpm dev:api   # Express on http://localhost:3001
```

### Open in Browser

Navigate to [http://localhost:3000](http://localhost:3000). You'll see the app running in **Mock Mode** with fake Telegram user data.

---

## ğŸ¤– Telegram Bot Configuration

Follow these steps to set up your bot and enable the "Menu" button (or "Play" button) to launch your Mini App directly from the chat.

### 1. Create a Bot with BotFather
1. Open [BotFather](https://t.me/BotFather) in Telegram.
2. Send `/newbot` and follow the prompts to create a new bot.
3. Copy the **API Token** and paste it into `apps/api/.env` as `BOT_TOKEN`.

### 2. Tunneling with Ngrok (Local Development)
To test your app within Telegram, you need an HTTPS URL. We use Ngrok to tunnel your local server.

1. Install Ngrok from [ngrok.com](https://ngrok.com).
2. Run the tunnel for your frontend (default port 3000):
   ```bash
   ngrok http 3000
   ```
3. Copy the **HTTPS URL** generated by Ngrok (e.g., `https://your-tunnel-id.ngrok-free.app`).

### 3. Connect Web App to Bot
You can link your Web App to the bot in two ways:

#### Option A: Direct Link (t.me/...)
1. In BotFather, send `/newapp`.
2. Select your bot.
3. Enter a title and description.
4. When asked for the **Web App URL**, paste your **Ngrok HTTPS URL**.
5. Enter a short name for the link (e.g., `app`).
   - *Result*: Users can open your app via `t.me/your_bot_name/app`.

#### Option B: Menu Button (Chat Button)
This adds a permanent "Menu" or "Play" button next to the text input in your bot's chat.

1. In BotFather, send `/mybots` and select your bot.
2. Go to **Bot Settings** â†’ **Menu Button** â†’ **Configure Menu Button**.
3. Send the **Ngrok HTTPS URL** when prompted.
4. Enter a title for the button (e.g., "Play").

**Note**: If you restart Ngrok, your URL will change. You must update the URL in BotFather using `/mybots` â†’ `Bot Settings` â†’ `Menu Button` â†’ `Edit Menu Button` (and `/editapp` for the direct link).

---

## ğŸ”§ Mock Environment

The boilerplate includes a `MockTelegramProvider` that enables browser-based development:

### How it works

1. **Automatic Detection** â€” Checks if `window.Telegram.WebApp` exists
2. **Mock Mode** â€” When not in Telegram, injects fake user data
3. **Visual Indicator** â€” Shows a yellow banner in development mode
4. **Seamless Transition** â€” Same code works in both environments

### Mock User Data

```typescript
{
  id: 123456789,
  first_name: 'Dev',
  last_name: 'User',
  username: 'devuser',
  photo_url: 'https://api.dicebear.com/...',
  language_code: 'en',
  is_premium: false
}
```

---

## ğŸ” Telegram Validation

The API includes a placeholder middleware for validating Telegram `initData`:

```
apps/api/src/middleware/validateTelegramData.ts
```

âš ï¸ **IMPORTANT**: Before going to production, implement proper HMAC-SHA256 validation using your `BOT_TOKEN`. See the [Telegram documentation](https://core.telegram.org/bots/webapps#validating-data-received-via-the-mini-app).

---

## ğŸ“¦ Shared Package

The `@tma/shared` package contains types used by both frontend and backend:

```typescript
import type { TelegramUser, ApiResponse, HealthResponse } from '@tma/shared';
```

### Available Types

- `TelegramUser` â€” User data from Telegram
- `TelegramWebAppUser` â€” Extended user data
- `TelegramChat` â€” Chat information
- `ApiResponse<T>` â€” Standardized API response wrapper
- `HealthResponse` â€” Health check response
- `PaginationParams` â€” Pagination parameters
- `PaginatedResponse<T>` â€” Paginated response wrapper

---

## ğŸ¨ UI Components

The frontend uses [shadcn/ui](https://ui.shadcn.com/) with the New York style:

```bash
# Add more components
cd apps/web
pnpm dlx shadcn@latest add [component-name]
```

Available components are configured in `apps/web/components.json`.

---

## ğŸ“¡ API Endpoints

### Health Check

```
GET /health
GET /health/ready
GET /health/live
```

### Adding New Routes

1. Create a route file in `apps/api/src/routes/`
2. Import and use in `apps/api/src/index.ts`
3. Add Telegram validation middleware as needed

---

## ğŸ› ï¸ Scripts

| Command | Description |
|---------|-------------|
| `pnpm dev` | Start all apps in development mode |
| `pnpm dev:web` | Start only the frontend |
| `pnpm dev:api` | Start only the backend |
| `pnpm build` | Build all apps for production |
| `pnpm lint` | Run linting across all apps |
| `pnpm clean` | Remove all node_modules |

---

## ğŸŒ Environment Variables

### API (`apps/api/.env`)

```env
PORT=3001
BOT_TOKEN=your_telegram_bot_token_here
ALLOWED_ORIGINS=http://localhost:3000
```

### Web (`apps/web/.env.local`)

```env
NEXT_PUBLIC_API_URL=http://localhost:3001
```

---

## ğŸ“š Resources

- [Telegram Mini Apps Documentation](https://core.telegram.org/bots/webapps)
- [Next.js Documentation](https://nextjs.org/docs)
- [shadcn/ui Components](https://ui.shadcn.com/)
- [Tailwind CSS](https://tailwindcss.com/)

---

## ğŸ“„ License

MIT License â€” Feel free to use this boilerplate for your projects!

---

Built with â¤ï¸ for the Telegram Mini App ecosystem
